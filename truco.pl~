:- include(cartas).
:- include(escala).

% OBJETIVOS PRELIMINARES
% Dada una carta, indica la posiciÃ³n de la misma en la escala de valores.
% valor(carta(Numero, Palo), Valor)

% Indica el resultado de enfrentar Carta1 y Carta2. Los resultados son gana, pierde o parda.

resultado(Carta1, Carta2, Resultado) :-
  valor(Carta1, Valor1),
  valor(Carta2, Valor2),
  (Valor1 > Valor2, Resultado = gana;
  Valor1 < Valor2, Resultado = pierde;
  Valor1 == Valor2, Resultado = parda).


% OBJETIVOS INTERMEDIOS
% Dada una mano indique su valor de envido

envido(Mano, Valor) :-
 %validar cartas ingresadas
 hayEnvido(Mano),
 seleccionarCartasEnvido(Mano, CartaEnvido1, CartaEnvido2),
 obtenerValorEnvido(CartaEnvido1, CartaEnvido2, Valor).

hayEnvido([carta(_, Palo1), carta(_, Palo2), carta(_, Palo3)]) :-
    dosMismoPalo(Carta1, Carta2);
    dosMismoPalo(Carta2, Carta3);
    dosMismoPalo(Carta3, Carta1).

tresMismoPalo([Carta1, Carta2, Carta3]) :-
    dosMismoPalo(Carta1, Carta2),
    dosMismoPalo(Carta1, Carta3).

dosMismoPalo(carta(_, Palo1), carta(_, Palo2)) :-
    Palo1 == Palo2.

seleccionarCartasEnvido([Carta1, Carta2, Carta3], CartaEnvido1, CartaEnvido2) :-
    (
        tresMismoPalo([Carta1, Carta2, Carta3]),
        obtenerMejoresCartasEnvidoDe3([Carta1, Carta2, Carta3], CartaEnvido1, CartaEnvido2)
    );
    (dosMismoPalo(Carta1, Carta2),  CartaEnvido1 = Carta1, CartaEnvido2 = Carta2);
    (dosMismoPalo(Carta2, Carta3),  CartaEnvido1 = Carta2, CartaEnvido2 = Carta3);
    (dosMismoPalo(Carta3, Carta1),  CartaEnvido1 = Carta3, CartaEnvido2 = Carta1).

obtenerMejoresCartasEnvidoDe3([Carta1, Carta2, Carta3], CartaEnvido1, CartaEnvido2) :-
    valorCartaEnvido(Carta1, ValorEnvidoCarta1),
    valorCartaEnvido(Carta2, ValorEnvidoCarta2),
    valorCartaEnvido(Carta3, ValorEnvidoCarta3),
    (
        ValorEnvidoCarta1 > ValorEnvidoCarta2, CartaEnvido1 is Carta1;
        ValorEnvidoCarta2 > ValorEnvidoCarta3, CartaEnvido2 is Carta2;
        CartaEnvido2 is Carta3
    ).

obtenerValorEnvido(Carta1, Carta2, Valor) :-
  valorCartaEnvido(Carta1, ValorEnvidoCarta1),
  valorCartaEnvido(Carta2, ValorEnvidoCarta2),
  Valor is 20 +  ValorEnvidoCarta1 + ValorEnvidoCarta2.

valorCartaEnvido(carta(Numero, _), ValorEnvido) :-
  (7 >= Numero, ValorEnvido = Numero);
  ValorEnvido = 0.

lista([1,2,3,3,4]) .
